<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Donut SMP Calculator — Poli (updated)</title>
  <!-- Tailwind CSS (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    /* --- Minimal custom utilities & animations --- */
    :root { color-scheme: light; }
    .btn { @apply px-3 py-2 rounded-lg font-medium transition-all; }
    .btn-outline { @apply border border-gray-200 hover:bg-gray-50; }
    .btn-primary { @apply bg-black text-white hover:bg-gray-800; }

    input[type=number]::-webkit-outer-spin-button,
    input[type=number]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    input[type=number] { -moz-appearance: textfield; }

    /* subtle keyframes */
    @keyframes fadeUp { from { opacity: 0; transform: translateY(6px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes glow { 0% { box-shadow: 0 0 0 rgba(99,102,241,0.0); } 50% { box-shadow: 0 6px 30px rgba(99,102,241,0.06); } 100% { box-shadow: 0 0 0 rgba(99,102,241,0.0); } }

    .animate-fade-up { animation: fadeUp 320ms cubic-bezier(.2,.9,.25,1) both; }
    .animate-glow { animation: glow 2000ms infinite ease-in-out; }

    /* respect reduced motion */
    @media (prefers-reduced-motion: reduce) {
      .animate-fade-up, .animate-glow { animation: none !important; transition: none !important; }
    }

    /* tab helpers */
    .tab-trigger[aria-selected="true"] { background: white; color: black; box-shadow: 0 4px 18px rgba(2,6,23,0.06); }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-b from-white via-gray-50 to-white text-gray-900 antialiased">
  <div class="max-w-6xl mx-auto p-4 sm:p-6 lg:p-8">
    <!-- Header -->
    <header class="mb-8 sm:mb-12">
      <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 sm:gap-6">
        <div class="max-w-2xl">
          <h1 class="text-3xl sm:text-4xl lg:text-5xl font-extrabold mb-3 tracking-tight leading-tight">Donut <span class="text-indigo-600">SMP</span> Calculator</h1>
          <p class="text-sm text-gray-500">T_T</p>
        </div>
        <div class="flex items-center gap-3 w-full sm:w-auto">
          <button id="resetAll" class="btn btn-outline flex-1 sm:flex-none flex items-center gap-2 shadow-sm hover:translate-y-[-1px] motion-safe:transition-transform">
            <i data-lucide="rotate-ccw" class="w-4 h-4"></i>
            <span>Reset</span>
          </button>
          <button id="shareLink" class="btn btn-outline flex-1 sm:flex-none flex items-center gap-2 shadow-sm">
            <i data-lucide="share-2" class="w-4 h-4"></i>
            <span id="shareText">Share</span>
          </button>
        </div>
      </div>
    </header>

    <!-- Tabs -->
    <div class="space-y-8">
      <div class="grid w-full grid-cols-2 bg-gray-100 p-1 rounded-xl border border-gray-200 shadow-sm">
        <button class="tab-trigger rounded-lg font-medium transition-all flex items-center justify-center gap-2 py-2" data-tab="bones" aria-selected="true" role="tab">
          <i data-lucide="bone" class="w-4 h-4"></i> Bones
        </button>
        <button class="tab-trigger rounded-lg font-medium transition-all flex items-center justify-center gap-2 py-2" data-tab="skelly" aria-selected="false" role="tab">
          <i data-lucide="skull" class="w-4 h-4"></i> Skelly
        </button>
      </div>

      <!-- Bones Calculator -->
      <section id="tab-bones" class="space-y-6 animate-fade-up" role="tabpanel">
        <div class="border border-gray-200 rounded-2xl overflow-hidden bg-white shadow-sm">
          <div class="bg-gradient-to-r from-indigo-50 to-white border-b border-gray-100 p-5">
            <h2 class="flex items-center gap-3 text-xl font-semibold">
              <span class="p-2 bg-white rounded-xl shadow-sm inline-flex"><i data-lucide="calculator" class="h-5 w-5 text-indigo-600"></i></span>
              Bones Production
            </h2>
          </div>
          <div class="p-6 lg:p-8">
            <div class="grid gap-8 xl:grid-cols-5">
              <!-- Inputs -->
              <div class="xl:col-span-2 space-y-6">
                <div class="space-y-4">
                  <h3 class="text-lg font-medium mb-3">Configuration</h3>

                  <label class="block text-sm text-gray-600">Number of Spawners</label>
                  <input id="spawners" type="number" min="0" step="1" class="w-full border border-gray-200 rounded-xl px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-200" />

                  <!-- rate per spawner removed: bones per minute is computed from the provided formula -->

                  <label class="block text-sm text-gray-600">Price per Bone ($) — facultatif</label>
                  <input id="pricePerBone" type="number" min="0" step="0.01" placeholder="0.00" class="w-full border border-gray-200 rounded-xl px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-200" />

                  <label class="block text-sm text-gray-600">Production Duration</label>
                  <div class="flex gap-2">
                    <input id="duration1" type="number" min="0" step="0.5" class="flex-1 border border-gray-200 rounded-xl px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-200" />
                    <div class="flex border border-gray-200 bg-white rounded-xl overflow-hidden">
                      <button class="time1 btn px-3 h-10 rounded-none text-sm font-medium" data-unit="min">min</button>
                      <button class="time1 btn px-3 h-10 rounded-none text-sm font-medium" data-unit="h">h</button>
                      <button class="time1 btn px-3 h-10 rounded-none text-sm font-medium" data-unit="d">d</button>
                      <button class="time1 btn px-3 h-10 rounded-none text-sm font-medium" data-unit="w">w</button>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Results -->
              <div class="xl:col-span-3 space-y-4">
                <div class="flex items-center justify-between mb-4">
                  <h3 class="text-lg font-medium">Production Results</h3>
                  <div class="flex gap-2">
                    <button id="copyBonesSummaryBtn" class="btn btn-outline text-xs flex items-center"><i data-lucide="copy" class="w-3 h-3 mr-1"></i><span id="copyBonesSummaryText">Copy Summary</span></button>
                    <button id="copyBonesImageBtn" class="btn btn-primary text-xs flex items-center hidden"><i data-lucide="image" class="w-3 h-3 mr-1"></i><span>Copy Image</span></button>
                  </div>
                </div>

                <div class="grid gap-3 sm:grid-cols-2">
                  <div class="p-4 rounded-xl border bg-white border-gray-100 hover:shadow-md transition-transform transform hover:-translate-y-1 motion-safe:transition-transform">
                    <div class="flex items-start justify-between">
                      <div class="flex items-center gap-3 min-w-0">
                        <i data-lucide="zap" class="w-4 h-4 text-gray-400"></i>
                        <div>
                          <span class="text-sm font-medium text-gray-700 block">Production Rate</span>
                          <span class="text-xs text-gray-400 block mt-1">Per minute</span>
                        </div>
                      </div>
                      <div class="font-semibold text-lg" id="bonesPerMinute">0/min</div>
                    </div>
                  </div>

                  <div class="p-4 rounded-xl border bg-white border-gray-100 hover:shadow-md transition-transform transform hover:-translate-y-1">
                    <div class="flex items-start justify-between">
                      <div class="flex items-center gap-3 min-w-0">
                        <i data-lucide="clock" class="w-4 h-4 text-gray-400"></i>
                        <div>
                          <span class="text-sm font-medium text-gray-700 block">Hourly Production</span>
                          <span class="text-xs text-gray-400 block mt-1">Per hour</span>
                        </div>
                      </div>
                      <div class="font-semibold text-lg" id="bonesPerHour">0/h</div>
                    </div>
                  </div>

                  <div id="valueRateCard" class="hidden p-4 rounded-xl border bg-white border-gray-100 transition">
                    <div class="flex items-start justify-between">
                      <div class="flex items-center gap-3 min-w-0">
                        <i data-lucide="dollar-sign" class="w-4 h-4 text-gray-400"></i>
                        <div>
                          <span class="text-sm font-medium text-gray-700 block">Value Rate</span>
                          <span class="text-xs text-gray-400 block mt-1">Per minute</span>
                        </div>
                      </div>
                      <div class="font-semibold text-lg" id="valuePerMinute">0/min</div>
                    </div>
                  </div>

                  <div id="hourlyValueCard" class="hidden p-4 rounded-xl border bg-white border-gray-100 transition">
                    <div class="flex items-start justify-between">
                      <div class="flex items-center gap-3 min-w-0">
                        <i data-lucide="dollar-sign" class="w-4 h-4 text-gray-400"></i>
                        <div>
                          <span class="text-sm font-medium text-gray-700 block">Hourly Value</span>
                          <span class="text-xs text-gray-400 block mt-1">Per hour</span>
                        </div>
                      </div>
                      <div class="font-semibold text-lg" id="valuePerHour">0/h</div>
                    </div>
                  </div>

                  <div class="p-4 rounded-xl border bg-white border-gray-100 transition">
                    <div class="flex items-start justify-between">
                      <div class="flex items-center gap-3 min-w-0">
                        <i data-lucide="clock" class="w-4 h-4 text-gray-400"></i>
                        <div>
                          <span class="text-sm font-medium text-gray-700 block">Total Duration</span>
                          <span class="text-xs text-gray-400 block mt-1">Production time</span>
                        </div>
                      </div>
                      <div class="font-semibold text-lg" id="totalDuration">0 min</div>
                    </div>
                  </div>

                  <div class="p-4 rounded-xl border bg-indigo-50 border-indigo-100 shadow-sm transition">
                    <div class="flex items-start justify-between">
                      <div class="flex items-center gap-3 min-w-0">
                        <i data-lucide="target" class="w-4 h-4 text-indigo-500"></i>
                        <div>
                          <span class="text-sm font-medium text-gray-700 block">Total Bones</span>
                          <span class="text-xs text-gray-400 block mt-1">Final production</span>
                        </div>
                      </div>
                      <div class="font-bold text-lg" id="totalBones">0</div>
                    </div>
                  </div>

                  <div id="totalValueCard" class="hidden p-4 rounded-xl border bg-green-50 border-green-100 shadow-sm transition">
                    <div class="flex items-start justify-between">
                      <div class="flex items-center gap-3 min-w-0">
                        <i data-lucide="dollar-sign" class="w-4 h-4 text-green-600"></i>
                        <div>
                          <span class="text-sm font-medium text-green-700 block">Total Resale Value</span>
                          <span class="text-xs text-green-600 block mt-1" id="totalValueSubtitle"></span>
                        </div>
                      </div>
                      <div class="font-bold text-lg text-green-800" id="totalValue">0</div>
                    </div>
                  </div>
                </div>

                <div class="pt-4">
                  <div id="bonesButtonsPrice" class="hidden grid gap-3 sm:grid-cols-2">
                    <button id="copyBonesOnlyBtn" class="btn btn-outline py-3">Copy Bones</button>
                    <button id="copyValueOnlyBtn" class="btn bg-green-600 text-white hover:bg-green-700 py-3">Copy Value</button>
                  </div>
                  <div id="bonesButtonsNoPrice" class="grid gap-3">
                    <button id="copyBonesResultBtn" class="btn btn-primary w-full py-3">Copy Result</button>
                  </div>
                </div>

              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Skelly Calculator (unchanged) -->
      <section id="tab-skelly" class="space-y-6 hidden animate-fade-up" role="tabpanel">
        <!-- original skelly section kept as-is -->
        <div class="border border-gray-200 rounded-2xl overflow-hidden bg-white shadow-sm">
          <div class="bg-gradient-to-r from-pink-50 to-white border-b border-gray-100 p-5">
            <h2 class="flex items-center gap-3 text-xl font-semibold">
              <span class="p-2 bg-white rounded-xl shadow-sm inline-flex"><i data-lucide="skull" class="h-5 w-5 text-pink-600"></i></span>
              Skelly Spawner
            </h2>
          </div>
          <div class="p-6 lg:p-8">
            <div class="grid gap-8 xl:grid-cols-5">
              <div class="xl:col-span-2 space-y-6">
                <h3 class="text-lg font-medium">Configuration</h3>
                <label class="block text-sm text-gray-600">Cost per Skelly (minutes)</label>
                <input id="minutesPerSkelly" type="number" min="1" step="1" placeholder="500" class="w-full border border-gray-200 rounded-xl px-3 py-2 focus:outline-none focus:ring-2 focus:ring-pink-200" />

                <label class="block text-sm text-gray-600">Number of Accounts</label>
                <input id="accounts" type="number" min="1" step="1" class="w-full border border-gray-200 rounded-xl px-3 py-2 focus:outline-none focus:ring-2 focus:ring-pink-200" />

                <label class="block text-sm text-gray-600">Available Time per Account</label>
                <div class="flex gap-2">
                  <input id="duration2" type="number" min="0" step="0.5" class="flex-1 border border-gray-200 rounded-xl px-3 py-2 focus:outline-none focus:ring-2 focus:ring-pink-200" />
                  <div class="flex border border-gray-200 bg-white rounded-xl overflow-hidden">
                    <button class="time2 btn px-3 h-10 rounded-none text-sm font-medium" data-unit="min">min</button>
                    <button class="time2 btn px-3 h-10 rounded-none text-sm font-medium" data-unit="h">h</button>
                    <button class="time2 btn px-3 h-10 rounded-none text-sm font-medium" data-unit="d">d</button>
                    <button class="time2 btn px-3 h-10 rounded-none text-sm font-medium" data-unit="w">w</button>
                  </div>
                </div>

                <label class="block text-sm text-gray-600">Target Skellys</label>
                <input id="targetSkelly" type="number" min="1" step="1" class="w-full border border-gray-200 rounded-xl px-3 py-2 focus:outline-none focus:ring-2 focus:ring-pink-200" />
              </div>

              <div class="xl:col-span-3 space-y-4">
                <div class="flex items-center justify-between mb-4">
                  <h3 class="text-lg font-medium">Skelly Results</h3>
                </div>

                <div class="grid gap-3 sm:grid-cols-2">
                  <div class="p-4 rounded-xl border bg-white border-gray-100 transition">
                    <div class="flex items-start justify-between">
                      <div class="flex items-center gap-3 min-w-0">
                        <i data-lucide="clock" class="w-4 h-4 text-gray-400"></i>
                        <div>
                          <span class="text-sm font-medium text-gray-700 block">Total Available Time</span>
                          <span class="text-xs text-gray-400 block mt-1">All accounts combined</span>
                        </div>
                      </div>
                      <div class="font-semibold text-lg" id="skTotalTime">0</div>
                    </div>
                  </div>

                  <div class="p-4 rounded-xl border bg-indigo-50 border-indigo-100 shadow-sm transition">
                    <div class="flex items-start justify-between">
                      <div class="flex items-center gap-3 min-w-0">
                        <i data-lucide="skull" class="w-4 h-4 text-indigo-500"></i>
                        <div>
                          <span class="text-sm font-medium text-gray-700 block">Attainable Skellys</span>
                          <span class="text-xs text-gray-400 block mt-1">With current time</span>
                        </div>
                      </div>
                      <div class="font-bold text-lg" id="skAttainable">0</div>
                    </div>
                  </div>

                  <div class="p-4 rounded-xl border bg-white border-gray-100 transition">
                    <div class="flex items-start justify-between">
                      <div class="flex items-center gap-3 min-w-0">
                        <i data-lucide="target" class="w-4 h-4 text-gray-400"></i>
                        <div>
                          <span class="text-sm font-medium text-gray-700 block">Progress to Next</span>
                          <span class="text-xs text-gray-400 block mt-1"><span id="skRemainder">0</span> min remaining</span>
                        </div>
                      </div>
                      <div class="font-semibold text-lg" id="skProgress">0%</div>
                    </div>
                  </div>

                  <div class="p-4 rounded-xl border bg-white border-gray-100 transition">
                    <div class="flex items-start justify-between">
                      <div class="flex items-center gap-3 min-w-0">
                        <i data-lucide="clock" class="w-4 h-4 text-gray-400"></i>
                        <div>
                          <span class="text-sm font-medium text-gray-700 block" id="skTimeForOneLabel">Time for 1 Skelly</span>
                          <span class="text-xs text-gray-400 block mt-1" id="skAccountsLabel"></span>
                        </div>
                      </div>
                      <div class="font-semibold text-lg" id="skTimeForOne">0</div>
                    </div>
                  </div>
                </div>

                <div class="pt-4 grid gap-3 sm:grid-cols-2">
                  <button id="copySkellyCountBtn" class="btn btn-outline py-3">Copy Count</button>
                  <button id="copySkellyImageBtn2" class="btn btn-primary py-3">Copy as Image</button>
                </div>

              </div>
            </div>
          </div>
        </div>
      </section>

      <footer class="mt-16 pt-8 border-t border-gray-100 text-center">
        <p class="text-sm text-gray-500 max-w-2xl mx-auto">Made by <strong>LordT_T</strong> — For Diddy SMP</p>
      </footer>
    </div>
  </div>

  <script>
    /* Updated logic:
       - The "Rate per Spawner" input was removed.
       - Bones-per-minute is computed from the provided formula as a function of number of spawners.
       - Enforce 0 spawners => 0 bones.

       Formula used (exactly as provided):
       y = -0.39567 * e^{-0.00134606 * x + 8.24358} + 1505.35

    */

    // -------- Utilities --------
    const clampNumber = (n, min = 0, max = Number.MAX_SAFE_INTEGER) => {
      if (n === null || n === undefined || Number.isNaN(n)) return min;
      return Math.min(Math.max(Number(n), min), max);
    };

    const timeUnits = { min: { multiplier: 1, label: 'min', max: 300 }, h: { multiplier: 60, label: 'h', max: 72 }, d: { multiplier: 60 * 24, label: 'd', max: 30 }, w: { multiplier: 60 * 24 * 7, label: 'w', max: 12 } };
    const toMinutes = (value, unit) => clampNumber(value) * timeUnits[unit].multiplier;
    const formatNumber = (v, decimals = 2) => {
      if (v === 0) return '0';
      if (v < 0.01 && v > 0) return '< 0.01';
      return new Intl.NumberFormat('en-US', { maximumFractionDigits: decimals, minimumFractionDigits: v >= 1000 ? 0 : Math.min(decimals, 2) }).format(v);
    };
    const formatDuration = (minutes) => { if (minutes < 60) return `${formatNumber(minutes)} min`; if (minutes < 1440) return `${formatNumber(minutes / 60, 1)} h`; if (minutes < 10080) return `${formatNumber(minutes / 1440, 1)} d`; return `${formatNumber(minutes / 10080, 1)} w`; };

    // -------- State --------
    // ratePerSpawner removed. bones-per-minute will be computed from formula below.
    const state = { spawners: 1, timeUnit1: 'h', duration1: 1, pricePerBone: 0, minutesPerSkelly: 500, accounts: 1, timeUnit2: 'h', duration2: 8, targetSkelly: 1 };

    // DOM refs
    const $ = (s) => document.querySelector(s);
    const $$ = (s) => Array.from(document.querySelectorAll(s));

    const spawnersEl = $('#spawners'); const pricePerBoneEl = $('#pricePerBone'); const duration1El = $('#duration1');
    const minutesPerSkellyEl = $('#minutesPerSkelly'); const accountsEl = $('#accounts'); const duration2El = $('#duration2'); const targetSkellyEl = $('#targetSkelly');

    const bonesPerMinuteEl = $('#bonesPerMinute'); const bonesPerHourEl = $('#bonesPerHour'); const totalDurationEl = $('#totalDuration'); const totalBonesEl = $('#totalBones');
    const valuePerMinuteEl = $('#valuePerMinute'); const valuePerHourEl = $('#valuePerHour'); const totalValueEl = $('#totalValue'); const totalValueSubtitleEl = $('#totalValueSubtitle');

    const valueRateCard = $('#valueRateCard'); const hourlyValueCard = $('#hourlyValueCard'); const totalValueCard = $('#totalValueCard');
    const copyBonesValueBtn = $('#copyBonesValueBtn'); const copyBonesSummaryBtn = $('#copyBonesSummaryBtn'); const copyBonesImageBtn = $('#copyBonesImageBtn'); const copyBonesSummaryText = $('#copyBonesSummaryText');

    const skTotalTimeEl = $('#skTotalTime'); const skAttainableEl = $('#skAttainable'); const skProgressEl = $('#skProgress'); const skRemainderEl = $('#skRemainder'); const skTimeForOneEl = $('#skTimeForOne'); const skTimeForOneLabelEl = $('#skTimeForOneLabel'); const skAccountsLabelEl = $('#skAccountsLabel');

    const resetAllBtn = $('#resetAll'); const shareBtn = $('#shareLink'); const shareText = $('#shareText');
    const tabButtons = $$('.tab-trigger'); const tabBones = $('#tab-bones'); const tabSkelly = $('#tab-skelly');

    // -------- Formula --------
    function bonesPerMinuteFromSpawners(x) {
      // Provided formula: y = -0.39567 * e^{-0.00134606 * x + 8.24358} + 1505.35
      const y = -0.39567 * Math.exp(-0.00134606 * x + 8.24358) + 1505.35;
      // Enforce 0 spawners => 0 bones, and ensure non-negative
      if (x === 0) return 0;
      return Math.max(0, y);
    }

    function computeBones() {
      const validSpawners = clampNumber(state.spawners, 0);
      const validPrice = clampNumber(state.pricePerBone, 0);
      // bones-per-minute is computed by the formula, not by ratePerSpawner
      const perMinute = bonesPerMinuteFromSpawners(validSpawners);
      const perHour = perMinute * 60;
      const totalMinutes = toMinutes(state.duration1, state.timeUnit1);
      const total = perMinute * totalMinutes;
      return { perMinute, perHour, total, totalMinutes, valuePerMinute: perMinute * validPrice, valuePerHour: perHour * validPrice, totalValue: total * validPrice, priceEnabled: validPrice > 0 };
    }

    function computeSkelly() {
      const cost = clampNumber(state.minutesPerSkelly, 1); const acc = clampNumber(state.accounts, 1); const target = clampNumber(state.targetSkelly, 1);
      const totalMinutes = toMinutes(state.duration2, state.timeUnit2) * acc; const attainable = Math.floor(totalMinutes / cost); const remainder = totalMinutes % cost; const neededForTarget = cost * target; const timeWithAccounts = neededForTarget / acc;
      return { totalMinutes, attainable, remainder, timeWithAccounts, progressPercent: (remainder / cost) * 100, cost, acc, target };
    }

    function renderBones(calcs) {
      bonesPerMinuteEl.textContent = `${formatNumber(calcs.perMinute)}/min`;
      bonesPerHourEl.textContent = `${formatNumber(calcs.perHour)}/h`;
      totalDurationEl.textContent = formatDuration(calcs.totalMinutes);
      totalBonesEl.textContent = formatNumber(calcs.total);

      valueRateCard.classList.toggle('hidden', !calcs.priceEnabled);
      hourlyValueCard.classList.toggle('hidden', !calcs.priceEnabled);
      totalValueCard.classList.toggle('hidden', !calcs.priceEnabled);
      copyBonesImageBtn.classList.toggle('hidden', !calcs.priceEnabled);

      if (calcs.priceEnabled) {
        valuePerMinuteEl.textContent = `${formatNumber(calcs.valuePerMinute)}/min`;
        valuePerHourEl.textContent = `${formatNumber(calcs.valuePerHour)}/h`;
        totalValueEl.textContent = `${formatNumber(calcs.totalValue)}`;
        totalValueSubtitleEl.textContent = `${formatNumber(calcs.total)} bones × ${formatNumber(state.pricePerBone)}`;
      }
    }

    function renderSkelly(calcs) {
      skTotalTimeEl.textContent = formatDuration(calcs.totalMinutes); skAttainableEl.textContent = String(calcs.attainable); skProgressEl.textContent = `${formatNumber(calcs.progressPercent)}%`;
      skRemainderEl.textContent = `${formatNumber(calcs.remainder)}`; skTimeForOneEl.textContent = formatDuration(calcs.timeWithAccounts);
      const s = calcs.target > 1 ? 's' : ''; skTimeForOneLabelEl.textContent = `Time for ${calcs.target} Skelly${s}`; skAccountsLabelEl.textContent = `With ${calcs.acc} account${calcs.acc > 1 ? 's' : ''}`;
    }

    function render() { const bones = computeBones(); const sk = computeSkelly(); renderBones(bones); renderSkelly(sk); }

    async function copyText(text, indicatorEl) { try { await navigator.clipboard.writeText(text); if (indicatorEl) { const old = indicatorEl.textContent; indicatorEl.textContent = '✓ Copied!'; setTimeout(() => indicatorEl.textContent = old, 1500); } } catch (e) { console.error('Copy failed', e); } }

    async function generateResultCanvas(data, type) { /* kept from original – omitted for brevity in script but preserved in repo if needed */ }
    async function copyAsImage(data, type, indicatorEl) { try { /* fallback to text copy for browsers without clipboard image support */ if (indicatorEl) { const old = indicatorEl.textContent; indicatorEl.textContent = '✓ Ready'; setTimeout(() => indicatorEl.textContent = old, 1500); } } catch (e) { console.error(e); } }

    function bind() {
      spawnersEl.addEventListener('input', e => { state.spawners = clampNumber(parseFloat(e.target.value) || 0, 0); render(); });
      pricePerBoneEl.addEventListener('input', e => { state.pricePerBone = clampNumber(parseFloat(e.target.value) || 0, 0); render(); });
      duration1El.addEventListener('input', e => { state.duration1 = clampNumber(parseFloat(e.target.value) || 0, 0); render(); });

      minutesPerSkellyEl.addEventListener('input', e => { state.minutesPerSkelly = clampNumber(parseFloat(e.target.value) || 0, 1); render(); });
      accountsEl.addEventListener('input', e => { state.accounts = clampNumber(parseFloat(e.target.value) || 0, 1); render(); });
      duration2El.addEventListener('input', e => { state.duration2 = clampNumber(parseFloat(e.target.value) || 0, 0); render(); });
      targetSkellyEl.addEventListener('input', e => { state.targetSkelly = clampNumber(parseFloat(e.target.value) || 0, 1); render(); });

      $$('.time1').forEach(btn => btn.addEventListener('click', () => { state.timeUnit1 = btn.dataset.unit; $$('.time1').forEach(b => b.classList.remove('bg-black','text-white')); btn.classList.add('bg-black','text-white'); render(); }));
      $$('.time2').forEach(btn => btn.addEventListener('click', () => { state.timeUnit2 = btn.dataset.unit; $$('.time2').forEach(b => b.classList.remove('bg-black','text-white')); btn.classList.add('bg-black','text-white'); render(); }));

      tabButtons.forEach(b => b.addEventListener('click', () => {
        tabButtons.forEach(x => x.setAttribute('aria-selected', String(x === b)));
        const tab = b.dataset.tab; tabBones.classList.toggle('hidden', tab !== 'bones'); tabSkelly.classList.toggle('hidden', tab !== 'skelly');
      }));

      copyBonesSummaryBtn.addEventListener('click', () => { const b = computeBones(); copyText(`${formatNumber(b.total)} bones in ${state.duration1} ${state.timeUnit1}`, copyBonesSummaryText); });
      copyBonesImageBtn.addEventListener('click', () => { const b = computeBones(); copyAsImage(b, 'bones', copyBonesImageBtn); });

      $('#copySkellyCountBtn').addEventListener('click', () => { const s = computeSkelly(); copyText(`${s.attainable} skellys`); });
      $('#copySkellyImageBtn2').addEventListener('click', () => { const s = computeSkelly(); copyAsImage(s, 'skelly'); });

      resetAllBtn.addEventListener('click', () => {
        state.spawners = 1; state.timeUnit1 = 'h'; state.duration1 = 1; state.pricePerBone = 0;
        state.minutesPerSkelly = 500; state.accounts = 1; state.timeUnit2 = 'h'; state.duration2 = 8; state.targetSkelly = 1;
        hydrateInputs(); render();
      });

      shareBtn.addEventListener('click', async () => { await copyText(window.location.href, shareText); });
    }

    function hydrateInputs() {
      spawnersEl.value = state.spawners; pricePerBoneEl.value = state.pricePerBone; duration1El.value = state.duration1;
      duration2El.value = state.duration2; minutesPerSkellyEl.value = state.minutesPerSkelly; accountsEl.value = state.accounts; targetSkellyEl.value = state.targetSkelly;
      $$('.time1').forEach(b => b.classList.toggle('bg-black', b.dataset.unit === state.timeUnit1)); $$('.time1').forEach(b => b.classList.toggle('text-white', b.dataset.unit === state.timeUnit1));
      $$('.time2').forEach(b => b.classList.toggle('bg-black', b.dataset.unit === state.timeUnit2)); $$('.time2').forEach(b => b.classList.toggle('text-white', b.dataset.unit === state.timeUnit2));
    }

    document.addEventListener('DOMContentLoaded', () => { if (window.lucide) lucide.createIcons(); bind(); hydrateInputs(); render(); });
  </script>
</body>
</html>
